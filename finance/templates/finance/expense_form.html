{% extends "core/base.html" %} 
{% load crispy_forms_tags %} 
{# Assurez-vous d'avoir installé django-crispy-forms dans votre environnement pour utiliser crispy_forms_tags #}

{% block title %}
    Ajouter une Dépense Quotidienne
{% endblock title %}

{% block content %}
<style>
    #div_id_site_concerne, #div_id_vehicule_concerne, #div_id_equipement_concerne {
        display: none;
    }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Formulaire d'Ajout de Dépense</h4>
                </div>
                <div class="card-body">
                    
                    {# Le formulaire pointe vers la même URL pour la soumission #}
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %} 
                        
                        {# Affiche tous les champs du formulaire en utilisant le style Crispy Forms #}
                        {{ form|crispy }}
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <button type="submit" class="btn btn-success me-md-2">
                                <i class="fas fa-save"></i> Enregistrer
                            </button>
                            {# Bouton pour annuler et revenir à la liste des dépenses #}
                            <a href="{% url 'finance:expense_list' %}" class="btn btn-secondary">
                                Annuler
                            </a>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const categorieField = document.getElementById('id_categorie');
        const siteField = document.getElementById('div_id_site_concerne');
        const vehiculeField = document.getElementById('div_id_vehicule_concerne');
        const equipementField = document.getElementById('div_id_equipement_concerne');

        function toggleFields() {
            const selectedCategory = categorieField.value;

            // Hide all by default
            siteField.style.display = 'none';
            vehiculeField.style.display = 'none';
            equipementField.style.display = 'none';

            if (selectedCategory === 'REPARATION_VEHICULE' || selectedCategory === 'CARBURANT') {
                vehiculeField.style.display = 'block';
            } else if (selectedCategory === 'REPARATION_EQUIPEMENT' || selectedCategory === 'ACHAT_MATERIEL') {
                equipementField.style.display = 'block';
            } else if (selectedCategory !== 'LOYER' && selectedCategory !== 'ELECTRICITE' && selectedCategory !== 'EAU' && selectedCategory !== 'SALAIRE' && selectedCategory !== 'IMPOTS') {
                siteField.style.display = 'block';
            }
        }

        // Initial check
        toggleFields();

        // Add event listener
        categorieField.addEventListener('change', toggleFields);
    });
</script>
{% endblock extra_js %}
{% endblock content %}